# Python Forex Trading Bot

הפרויקט הזה הוא בסיס לבניית בוט מסחר בפורקס באמצעות פייתון.  הוא נבנה
בהשראת יועץ אוטומטי ב־MQL5 (קובץ **Speed_TrailingStopMM.mq5**) אשר
פותח פוזיציות כאשר המחיר נע מרחק מסוים (בפיפס) במשך פרק זמן מוגדר
ומשתמש בניהול כסף ומשיכת סטופ.  הארכיטקטורה של הבוט מבוססת על
העקרונות של מערכת מסחר אוטומטית: מודול להזנת נתונים, מנוע אסטרטגיה,
מודול לניהול סיכונים, מנהל ביצוע ויומן לוגים【820848303294803†L68-L100】,【173486630977379†L44-L52】.

## קבצים ותיקיות

```
.
├── main.py                – קובץ הכניסה שמפעיל את הבוט.
├── trading_bot/
│   ├── __init__.py         – הופך את התיקייה לחבילה פייתון.
│   ├── config.py           – מחזיק את הגדרות הבוט (סמל, גודל מרחק, זמן, TP/SL, וכו').
│   ├── data_feed.py        – מודול להתחברות ל־MetaTrader 5 ולמשיכת נתונים.
│   ├── risk_manager.py     – מחשב את גודל הפוזיציה לפי הון ו־MM.
│   ├── execution.py        – שולח פקודות קנייה/מכירה ומעדכן סטופ נגרר.
│   ├── strategy.py         – מממש את האסטרטגיה של מרחק/זמן.
│   ├── backtester.py        – מנוע בדיקה היסטורית הפועל על קובץ CSV.
│   └── utils.py            – פונקציות עזר להדפסות ולהמרת פיפסים.
└── requirements.txt       – רשימת חבילות להתקנה (MetaTrader5, pandas וכד׳).
```

## שלבי הקמה והרצה

1. **התקנת Python וספריות** – התקן Python גרסה 3.8 או חדשה יותר.  התקן את
   חבילת `MetaTrader5` (מתוך הפקודה `pip install MetaTrader5`) כדי לאפשר
   לפייתון ליצור קשר עם טרמינל MT5【899045643920828†L92-L105】.  התקן גם את
   `pandas` ו־`numpy` לעבודה עם נתונים ו־`matplotlib` אם תרצה גרפים.

2. **הגדרת טרמינל MT5** – הפעל טרמינל MetaTrader 5 במחשב המקומי ופתח חשבון
   דמו לבדיקות.  הבוט מתחבר לטרמינל המקומי באמצעות הקריאה
   `mt5.initialize()`【899045643920828†L268-L276】, לכן יש צורך שהטרמינל יהיה פתוח.

3. **עריכת קובץ ההגדרות** – ניתן לערוך את המשתנים במחלקה `BotConfig`
   בקובץ `config.py` כדי להתאים: סמל למסחר (`symbol`), מרחק בפיפס (`distance_pips`),
   חלון זמן בשניות (`time_seconds`), גודל פוזיציה קבוע (`lot_size`) או גודל
   פוזיציה מחושב לפי ההון (`mm`), וכל יתר ההגדרות.

4. **הרצת הבוט** – הפעל את `main.py`.  בעת ההפעלה הבוט:

   - מתחבר ל־MT5 ומגדיר את ערך הפיפס לפי מספר הספרות של הסמל.
   - יוצר מופעים של מודול ניהול סיכונים, מנהל ביצוע ואסטרטגיה.
   - בכל לולאה הוא מושך את מחיר הביד והאסק העדכני, בודק האם המחיר עבר
     את מרחק הפיפס המוגדר בפרק הזמן, ושולח פקודת קנייה או מכירה אם
     התנאים מתקיימים.
   - מחשב סטופ לוס וטייק פרופיט בהתאם להגדרות, ודואג שהמרחקים לא יפרו
     את המינימום הנדרש על ידי הברוקר.
   - אם מוגדר Trailing Stop, הבוט מעדכן את ה־SL כשהמחיר מתקדם לטובתנו.

5. **בדיקות היסטוריות** – לפני מסחר חי, מומלץ לבדוק את האסטרטגיה על
   נתוני עבר.  ניתן להשתמש בספריות כמו `Backtrader` או `vectorbt`
   המוזכרות במאמר של QuantInsti【524037092563000†L274-L303】 כדי להריץ
   את המודולים שלנו על נתונים היסטוריים ולבחון ביצועים.

   בנוסף נכלל בפרויקט מנוע בדיקה פנימי (`trading_bot/backtester.py`) שיכול
   להריץ את האסטרטגיה על קובץ CSV.  קובץ לדוגמה נמצא בתיקייה `data`.
   להרצה מהירה אפשר להשתמש בפקודה הבאה:

   ```bash
   python3 -c "from trading_bot.backtester import run_backtest;\
   from trading_bot.config import BotConfig;\
   trades = run_backtest('data/sample_data.csv', BotConfig());\
   print(trades)"
   ```

   הקובץ `data/sample_data.csv` מכיל מספר שורות של מחירי bid/ask כדי להדגים
   את השימוש במנוע.

## איך זה עובד

* **מודול הזנת נתונים** (`data_feed.py`) – יוצר חיבור ל־MT5, מקבל את ערך
  הפיפס (1 נקודה או 10 נקודות בהתאם לספרות), ומספק פונקציה לקבלת מחיר
  נוכחי ופונקציות למשיכת נתוני עבר.

* **מודול ניהול סיכונים** (`risk_manager.py`) – מחשב את גודל הפוזיציה.
  אם `mm` גדול מאפס, הגודל מחושב לפי ההון (`equity`) ומוגבל למינימום,
  מקסימום ו־step של הסמל【173486630977379†L44-L52】; אחרת משתמשים בגודל קבוע.

* **מודול הביצוע** (`execution.py`) – בונה פקודות למסחר (`order_send`) ומבצע
  קניות/מכירות, כולל SL/TP וניהול סטופ נגרר.  הפקודה נשלחת באמצעות מילון
  שמכיל סוג עסקה, סימול, גודל, מחיר, SL/TP, מספר קסם ושיטת מילוי.

* **מודול האסטרטגיה** (`strategy.py`) – שומר נקודת ייחוס (זמן ומחיר) לכל
  כיוון.  בכל טיק מחשב כמה פיפסים המחיר התקדם וכמה שניות עברו; אם
  המרחק גדול מהערך המוגדר והזמן קטן מהחלון – מבצע טרייד ומאפס את
  נקודת הייחוס.  אם פרק הזמן עבר ללא טרייד, נקודת הייחוס מתעדכנת.

## דרישות חבילות (requirements.txt)

```
MetaTrader5
pandas
numpy
```

ניתן להוסיף ספריות נוספות (למשל Backtrader או vectorbt) לשימוש בבדיקות
היסטוריות או ויזואליזציה.

## אזהרה

קוד זה מסופק למטרות לימוד בלבד.  מסחר במט״ח כרוך בסיכון גבוה.  לפני
השימוש בבוט על חשבון אמיתי יש לבדוק אותו היטב על נתוני עבר ובחשבון
דמו, ולהתייעץ עם מומחה.  הבוט לא מבצע בקרה רגולטורית או דיווחים,
ולכן מומלץ לשלבו במערכת מסחר מלאה הכוללת שכבת סיכון, ניהול ביצוע,
ובדיקות תאימות כפי שמפורט במאמרים על ארכיטקטורת מסחר אוטומטית【820848303294803†L68-L100】.
